<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running MiSSE • hisse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running MiSSE">
<meta property="og:description" content="hisse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hisse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Clade-specific-sampling.html">The Problem with Clade-specific Sampling Fractions</a>
    </li>
    <li>
      <a href="../articles/GeoHiSSE-vignette.html">Running GeoHiSSE</a>
    </li>
    <li>
      <a href="../articles/MiSSE-vignette.html">Running MiSSE</a>
    </li>
    <li>
      <a href="../articles/MuHiSSE-vignette.html">Running a Multistate HiSSE model</a>
    </li>
    <li>
      <a href="../articles/adding_fossils.html">Incorporating Fossils in HiSSE, MuHiSSE, and MiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-fisse-type1-vignette.html">Type I errors, Model rejection, &amp; HiSSE vs. FiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-new-vignette.html">A newer, faster HiSSE function</a>
    </li>
    <li>
      <a href="../articles/hisse-vignette.html">Running the old HiSSE function</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running MiSSE</h1>
                        <h4 data-toc-skip class="author">Jeremy M.
Beaulieu</h4>
            
      
      
      <div class="hidden name"><code>MiSSE-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>In Beaulieu and O’Meara (2016) we pointed out that the
trait-independent HiSSE model is basically a model for traits and a
separate model for shifts in diversification parameters, much like BAMM
(though without priors, discontinuous inheritance of extinction
probability, or other mathematical foibles). The hidden states can drive
different diversification processes, and the traits just evolve under a
regular Markovian trait model. At that point, there is no harm in just
dropping the trait altogether and just focusing on diversification
driven by unknown factors. This is what we meant by our HiSSE framework
essentially forming a continuum from a purely trait-independent model
(e.g., BAMM, or MEDUSA), to a completely trait-dependent model (e.g.,
BiSSE)(see discussion in Caetano et al., 2018). That is what this MiSSE
function does – it sets up and executes a completely trait-free version
of a HiSSE model. Thus, all that is required is a tree. The model allows
up to 26 possible hidden states in diversification (denoted by A-Z).
Transitions among hidden states are governed by a single global
transition rate, <span class="math inline">\(q\)</span>. A “shift” in
diversification denotes a lineage tracking some unobserved, hidden
state. An interesting byproduct of this assumption is that distantly
related clades can actually share the same discrete set of
diversification parameters.</p>
<p>Note that we refer to “hidden state” simply as a shorthand. We do not
mean that there is a single, discrete character that is solely driving
diversification differences. There is some heritable “thing” that
affects rates, such as a combination of body size, oxygen concentration,
trophic level, and, say, how many total species are competing for
resources in an area. In other words, it could be that there is some
single discrete trait that drives everything. However, it is more likely
that a whole range of factors play a role, and we just slice them up
into discrete categories, the same way we slice up mammals into
carnivore / omnivore / herbivore or plants into woody / herbaceous when
the reality is more continuous. This is true for HiSSE, but this concept
is especially important to grasp for MiSSE.</p>
</div>
<div class="section level2">
<h2 id="setting-up-a-misse-model">Setting up a MiSSE model<a class="anchor" aria-label="anchor" href="#setting-up-a-misse-model"></a>
</h2>
<p>The set up is similar to other functions in <code>hisse</code>,
except there is no need to set up a transition model For the following
example, we will use the cetacean phylogeny (e.g., whales and relatives)
of Steeman et al. (2009).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hisse</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: ape</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: deSolve</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenSA</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: subplex</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: nloptr</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="st">"whales_Steemanetal2009.tre"</span><span class="op">)</span></span></code></pre></div>
<p>As with <code>hisse</code>, rather than optimizing <span class="math inline">\(\lambda_i\)</span> and <span class="math inline">\(\mu_i\)</span> separately, <code>MiSSE</code>
optimizes transformations of these variables. We let <span class="math inline">\(\tau_i = \lambda_i+\mu_i\)</span> define “net
turnover”, and we let <span class="math inline">\(\epsilon_i = \mu_i /
\lambda_i\)</span> define the “extinction fraction”. This
reparameterization alleviates problems associated with over-fitting when
<span class="math inline">\(\lambda_i\)</span> and <span class="math inline">\(\mu_i\)</span> are highly correlated, but both
matter in explaining the diversity pattern (see discussion of this issue
in Beaulieu and O’Meara 2016). The number of free parameters in the
model for both net turnover and extinction fraction are specified as
index vectors provided to the function call. First, let us fit a single
rate model:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">one.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span></code></pre></div>
<p>Pretty simple. Now to fit a model that contains two rate classes, we
will simply expand out the turnover vector:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">two.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span></code></pre></div>
<p>Overall, <code>MiSSE</code> allows up to 26 possible hidden states in
diversification (denoted by A-Z), and in this example since we fit two
rate classes, we have two hidden states, A and B, impacting turnover
rates. Here is the rest of the model set applied to the whale data
set:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#rate classes A:C</span></span>
<span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">three.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span>
<span><span class="co">#rate classes A:D</span></span>
<span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">four.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span>
<span><span class="co">#rate classes A:E</span></span>
<span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">five.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span></code></pre></div>
<p>We can also let <span class="math inline">\(\epsilon_i\)</span> vary
across the tree:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">two.rate.weps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#rate classes A:C, but include eps as well:</span></span>
<span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">three.rate.weps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span><span class="op">)</span></span></code></pre></div>
<p>However, in the case of cetaceans, allowing extinction fraction to
vary does not provide any additional information to the model as all
rate classes return nearly identical estimates (not shown).</p>
<p>I have already fit these models. Figure 1 shows the improvement in
AIC as we increase the complexity of the model.</p>
<div class="figure">
<img src="MiSSE-vignette_files/figure-html/unnamed-chunk-6-1.png" alt="The fit of an incremental increase in the number of rate classes estimated under a MiSSE analysis of the cetacean phylogeny of Steeman et al. (2009). There is a clear reduction in AIC from one to three rate classes, which levels off at four rate classes and five rate classes returns an AIC that is about 1 unit higher than either the three and four rate class." width="700"><p class="caption">
The fit of an incremental increase in the number of rate classes
estimated under a MiSSE analysis of the cetacean phylogeny of Steeman et
al. (2009). There is a clear reduction in AIC from one to three rate
classes, which levels off at four rate classes and five rate classes
returns an AIC that is about 1 unit higher than either the three and
four rate class.
</p>
</div>
<p>##Plotting MiSSE reconstructions</p>
<p>Like with all other functions, we provide plotting functionality with
<code><a href="../reference/plotMiSSE.html">plot.misse.states()</a></code> for hidden state reconstructions of
<code>class misse.states</code> output by our
<code><a href="../reference/marginReconMiSSE.html">MarginReconMiSSE()</a></code> function. And, as with other functions,
a single <code>misse.states</code> object can be supplied and the
plotting function will provide a heat map of the diversification rate
parameter of choice, or a list of <code>misse.states</code> objects can
be supplied and the function will “model-average” the results. For
plotting rates, users can choose among turnover, net diversification
(“net.div”), speciation, extinction, or extinction fraction
(“extinction.fraction”). Below is an example of how to run the
reconstruction function to obtain <code>misse.states</code> output from
our two rate model for cetaceans. But, again, for simplicity, I have a
file that contains the reconstructions and we can check that everything
has loaded correctly and is of the proper <code>misse.states</code>
class:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># two.rate.recon &lt;- MarginReconMiSSE(phy=phy, f=1,  hidden.states=2, </span></span>
<span>                <span class="co">#pars=two.rate$solution, n.cores=3, AIC=two.rate$AIC)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"misse.vignette.Rsave"</span><span class="op">)</span> <span class="co"># Line above shows the command to create this result.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">two.rate.recon</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "misse.states"</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">two.rate.recon</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Phylogenetic tree with 87 tips and 86 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tip labels:</span></span>
<span><span class="co">##   Balaena_mysticetus, Eubalaena_australis, Eubalaena_glacialis, Eubalaena_japonica, Caperea_marginata, Eschrichtius_robustus, ...</span></span>
<span><span class="co">## Node labels:</span></span>
<span><span class="co">##   1, 1, 1, 1, 1, 1, ...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Rooted; includes branch lengths.</span></span></code></pre>
<p>Let’s take a look at the reconstruction for the <code>two.rate</code>
model reconstruction. I will simply supply the reconstruction object if
<code>misse.states</code> class to the plotting function,
<code><a href="../reference/plotMiSSE.html">plot.misse.states()</a></code>, and plot net diversification (see
Figure 2).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotMiSSE.html">plot.misse.states</a></span><span class="op">(</span><span class="va">two.rate.recon</span>, rate.param<span class="op">=</span><span class="st">"net.div"</span>, show.tip.label<span class="op">=</span><span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">"phylogram"</span>,</span>
<span>                  fsize<span class="op">=</span><span class="fl">.25</span>, legend<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="MiSSE-vignette_files/figure-html/unnamed-chunk-9-1.png" alt="A two-rate class MiSSE analysis and reconstruction of the cetacean phylogeny of Steeman et al. (2009) shows a clear increase in the net diversification rate within the Delphinidae (dolphins) relative to all other cetaceans; there also seems to be a slightly elevated rates in the sister group of Delphinidae, the Monodontidae+Phocenidae. Overall, this particular MiSSE model seems to correctly identify the source of 'trait-independent' diversification that can plague BiSSE analyses of simulated data sets on the cetacean tree (see Rabosky and Goldberg, 2015)." width="700"><p class="caption">
A two-rate class MiSSE analysis and reconstruction of the cetacean
phylogeny of Steeman et al. (2009) shows a clear increase in the net
diversification rate within the Delphinidae (dolphins) relative to all
other cetaceans; there also seems to be a slightly elevated rates in the
sister group of Delphinidae, the Monodontidae+Phocenidae. Overall, this
particular MiSSE model seems to correctly identify the source of
‘trait-independent’ diversification that can plague BiSSE analyses of
simulated data sets on the cetacean tree (see Rabosky and Goldberg,
2015).
</p>
</div>
<pre><code><span><span class="co">## $rate.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 87 tips and 86 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0.074823, 0.205397).</span></span></code></pre>
<p>Of course, in this example we have a set of models that includes
models that contain upwards of five rate classes. Also, we know from AIC
that there are three model – the three-, four-, and five rate class
models – that are within 2 AIC units away from each. As we do in all
other <code>hisse</code> functions, we allow for plots to be
model-averaging of the rates at nodes and tips. To do this, we simply
supply all reconstructions you want to average as elements in a list.
There are many ways to generate a list, but here is one way:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">misse.results.list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">misse.results.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">one.rate.recon</span></span>
<span><span class="va">misse.results.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">two.rate.recon</span></span>
<span><span class="va">misse.results.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">three.rate.recon</span></span>
<span><span class="va">misse.results.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">four.rate.recon</span></span>
<span><span class="va">misse.results.list</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">five.rate.recon</span></span></code></pre></div>
<p>And, as before, we simply supply this list to the plotting function,
<code><a href="../reference/plotMiSSE.html">plot.misse.states()</a></code>, and plot net diversification (see
Figure 3).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotMiSSE.html">plot.misse.states</a></span><span class="op">(</span><span class="va">misse.results.list</span>, rate.param<span class="op">=</span><span class="st">"net.div"</span>, show.tip.label<span class="op">=</span><span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">"phylogram"</span>,</span>
<span>                  fsize<span class="op">=</span><span class="fl">.25</span>, legend<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="MiSSE-vignette_files/figure-html/unnamed-chunk-12-1.png" alt="A model-averaged MiSSE analysis of the cetacean phylogeny of Steeman et al. (2009) shows an apparent slow down in the net diversification through time." width="700"><p class="caption">
A model-averaged MiSSE analysis of the cetacean phylogeny of Steeman et
al. (2009) shows an apparent slow down in the net diversification
through time.
</p>
</div>
<pre><code><span><span class="co">## $rate.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 87 tips and 86 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0.047889, 0.229038).</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="fixing-extinction-fraction">Fixing extinction fraction<a class="anchor" aria-label="anchor" href="#fixing-extinction-fraction"></a>
</h2>
<p>Estimating extinction is hard. This affects all diversification
models (even if all you want and look at is speciation rate, extinction
rate estimates still affect what this is as they affect the likelihood).
It is most noticeable in MiSSE with extinction fraction (extinction rate
divided by speciation rate). One option, following Magallon &amp;
Sanderson (2001), is to set extinction fraction at set values. We have
made this straightforward to do in the <code><a href="../reference/MiSSE.html">MiSSE()</a></code> function
call. The first step is to setup a Yule-based <code><a href="../reference/MiSSE.html">MiSSE()</a></code> run
by supplying a vector of zeros for <code>eps</code> that is of equal
length to the number of turnover rate classes:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">eps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>In the function call, there is an option called
<code>fixed.eps</code>. Normally, this is set to <code>NULL</code>,
which indicates that extinction fraction is to be estimated. When a
value is supplied to <code>fixed.eps</code> this will be the value used
throughout the parameter search. Here we assume there are two rate
classes and a fixed extinction fraction of 0.90:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">two.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSE.html">MiSSE</a></span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, turnover<span class="op">=</span><span class="va">turnover</span>, eps<span class="op">=</span><span class="va">eps</span>, fixed.eps<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-considerations">Other considerations<a class="anchor" aria-label="anchor" href="#other-considerations"></a>
</h2>
<p>Like with <code>hisse</code>, <code>GeoHiSSE</code>, and
<code>MuHiSSE</code>, there are functions available for generating
estimates of the uncertainty in the parameter estimates (i.e.,
<code><a href="../reference/supportRegionMiSSE.html">SupportRegionMiSSE()</a></code>), and to obtain model averages (i.e.,
<code><a href="../reference/modelAveRates.html">GetModelAveRates()</a></code>) for nodes, for tips, or for both to be
used in post-hoc tests. Users are encouraged to read other vignettes and
help pages provided for more information. For more conceptual
discussions of these functions and ideas, readers are also encouraged to
read Caetano et al. (2018).</p>
<p>There are two additional items that are worth mentioning. First, like
with <code>MuHiSSE</code>, I would recommend users try multiple random
starting points when optimizing any given model with <code>MiSSE</code>.
In Nakov et al. (2018), we found that the default starting values often
did not return the highest log likelihood. To alleviate this issue, we
performed <span class="math inline">\(\ge\)</span> 50 maximum likelihood
optimizations for each model, each initiated from a distinct starting
point. All functions within <code>hisse</code> are provided with
<code>starting.vals</code> option for these purposes.</p>
<p>Second, we note that <code>MiSSE</code> may seem slower than most
other functions within <code>hisse</code>. This is somewhat intentional.
Underneath the hood we have implemented a lot of checks to the
integration for calculating probabilities along branches. This will mean
that often times weird messages will spit out to the screen. For now,
ignore them, the optimization “feels” these issues and takes necessary
action. But this also means that users must pay particular attention to
the complexity of the models they are fitting and critically think
whether or not the parameters make sense. For example, in cetacean tree
used above, I attemped to fit a model with three, four, and five hidden
states, A, B, and C, but the reconstructions indicated a rather
complicated, and highly uncertain, diversification history:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">two.rate</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Fit </span></span>
<span><span class="co">##             lnL             AIC            AICc          n.taxa n.hidden.states </span></span>
<span><span class="co">##       -271.7681        551.5363        552.0241         87.0000          2.0000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model parameters: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   turnover0A        eps0A   turnover0B        eps0B           q0 </span></span>
<span><span class="co">## 7.489769e-02 2.061154e-09 2.052022e-01 2.061154e-09 3.743782e-03</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">three.rate</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Fit </span></span>
<span><span class="co">##             lnL             AIC            AICc          n.taxa n.hidden.states </span></span>
<span><span class="co">##       -263.9931        537.9863        538.7270         87.0000          3.0000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model parameters: </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  turnover0A       eps0A  turnover0B       eps0B  turnover0C       eps0C </span></span>
<span><span class="co">## 0.008069096 0.275802793 0.008083110 0.275802793 0.340152955 0.275802793 </span></span>
<span><span class="co">##          q0 </span></span>
<span><span class="co">## 0.131447160</span></span></code></pre>
<p>Note that the likelihood was a significant improvement from the two
rate model, but the transition rate, <span class="math inline">\(q\)</span>, is roughly two orders of magnitude
higher (<span class="math inline">\(q=0.131\)</span>) relative to the
two-rate model estimate (<span class="math inline">\(q=0.004\)</span>).
The same is true for the four and five rate class models. What does this
mean? Well, we can convert this into the expected number of transitions
by multiplying the rate by the sum of the branch lengths in the cetacean
phylogeny:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expected.transitions.two</span> <span class="op">&lt;-</span> <span class="fl">0.004</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">two.rate</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge.length</span><span class="op">)</span></span>
<span><span class="va">expected.transitions.two</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3.281109</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expected.transitions.three</span> <span class="op">&lt;-</span> <span class="fl">0.131</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">three.rate</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">edge.length</span><span class="op">)</span></span>
<span><span class="va">expected.transitions.three</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 107.4563</span></span></code></pre>
<p>At first glance, this might seem that something is off with the
three-rate class model – e.g., 3 vs. 107 number of shifts among the
different classes? However, examining the support region around the
parameters can give an indication as to the overall reliability of these
estimates:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"misse.support.Rsave"</span><span class="op">)</span></span>
<span><span class="va">two.rate.support</span><span class="op">$</span><span class="va">ci</span><span class="op">[</span>,<span class="st">"q0"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##           0%          25%          50%          75%         100% </span></span>
<span><span class="co">## 0.0009535839 0.0036835840 0.0065180114 0.0106515654 0.0206332391</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">three.rate.support</span><span class="op">$</span><span class="va">ci</span><span class="op">[</span>,<span class="st">"q0"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##         0%        25%        50%        75%       100% </span></span>
<span><span class="co">## 0.06839226 0.11308939 0.13144716 0.15736921 0.22772718</span></span></code></pre>
<p>In the case of the two rate class model, even though the MLE
indicates very few transitions among the rate classes, there is a model
within 2 log likelihood units that suggests as many as 17 expected
transitions. In other words, the <span class="math inline">\(q\)</span>
estimate even under the two rate class model is fairly certain. We
suspect that what is being picked up by these models is something that
is both clade-specific (i.e., implied by the two rate class model) and
time-dependent (i.e., implied by the three, four, and five rate class
models), with the latter exerting the strongest influence on the overall
fit.</p>
</div>
<div class="section level2">
<h2 id="misse-greedy">MiSSE Greedy<a class="anchor" aria-label="anchor" href="#misse-greedy"></a>
</h2>
<p>With the way <code><a href="../reference/MiSSE.html">MiSSE()</a></code> is implemented there are 52
possible models one could try, which would require coding each model by
hand. Of course, a model where there are 26 different classes of
turnover rates may be far too parameter rich that it’s not even worth
trying. The difficulty then is determining what the “right” stopping
point is in terms of adding further model complexity. We implemented
<code><a href="../reference/MiSSEGreedy.html">MiSSEGreedy()</a></code> as means of automating the process of fitting
a set of <code><a href="../reference/MiSSE.html">MiSSE()</a></code> models. It first runs a chunk of models,
determines the “best” based on AIC, then it continues on from that
complexity until the a more complex model is less than some user defined
<span class="math inline">\(\Delta\)</span>AIC than the <em>current</em>
best model. At that point, <code><a href="../reference/MiSSEGreedy.html">MiSSEGreedy()</a></code> stops running new
models. Since this is based on current best AICc, and we start with
simplest models. However, note that this produces an asymmetry, where a
terrible model with no rate variation is always included, but a slightly
less terrible model with 26 turnover rates might never be evaluated.</p>
<p>This functions work much faster when run in parallel. To do this, we
include an option <code>n.cores</code> to allow users to set the number
of available cores on your machine. The default is one core. Since many
models are evaluated, the most natural approach is to run one model per
core, see if at least one of the models are still ok, then send out the
next models out to all the cores. Setting n.cores to the number of
parallel jobs you want, and leaving chunk.size set to NULL, will do
this. However, this is slightly inefficient – the odds are that some
cores will finish earlier than others, and will be waiting until all
finish. So a different approach is to set a chunk.size greater than
n.cores – it will still use no more than n.cores at a time, but once one
model in the set finishes it will send off the next until all models in
the chunk are run. This keeps the computer even busier, but then it
won’t stop to check to make sure the models are still feasible as often,
and it only saves intermediate results after each chunk of models
finishes. Our recommendation is to use n.cores=parallel::detectCores()
if you’re on a machine where you can use all the cores and leave
chunk.size unspecified (so it will also default to n.cores), but it’s up
to you.</p>
<p>After every chunk of models are done, this function will display the
status: what models have been run, what the likelihoods and AICs are,
etc. It will also predict how long future runs will check, based on a
linear regression between the number of free parameters and log(minutes
to run). These are just estimates based on the runs so far, but it’s a
stochastic search and can take more or less time. Here is a very
straightforward <code><a href="../reference/MiSSEGreedy.html">MiSSEGreedy()</a></code> run:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rcoal</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">potential.combos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateMiSSEGreedyCombinations.html">generateMiSSEGreedyCombinations</a></span><span class="op">(</span>max.param<span class="op">=</span><span class="fl">4</span>, vary.both<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#run on one core:</span></span>
<span><span class="va">model.set</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSEGreedy.html">MiSSEGreedy</a></span><span class="op">(</span><span class="va">tree</span>, possible.combos<span class="op">=</span><span class="va">potential.combos</span>, n.cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#run on all available cores: (commented out because CRAN does not allow this in examples)</span></span>
<span><span class="va">model.set</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MiSSEGreedy.html">MiSSEGreedy</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">potential.combos</span>, n.cores<span class="op">=</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span>, f<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AICc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"[["</span>, <span class="st">"AICc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">deltaAICc</span> <span class="op">&lt;-</span> <span class="va">AICc</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">AICc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Yes, [[ is a function you can lapply, and the name of elements within each list</span></span>
<span><span class="co"># object can be arguments. Life is awesome.</span></span></code></pre></div>
<p>The output in <code>model.set</code> is a list of models evaluated.
From there you can just loop over each model and do the rate class
reconstruction:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.recons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model.set</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">model_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model.set</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nturnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model.set</span><span class="op">[[</span><span class="va">model_index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">turnover</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">neps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model.set</span><span class="op">[[</span><span class="va">model_index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">eps</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">misse_recon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marginReconMiSSE.html">MarginReconMiSSE</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">model.set</span><span class="op">[[</span><span class="va">model_index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">phy</span>, f <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                    hidden.states <span class="op">=</span> <span class="va">nturnover</span>, </span>
<span>                                    pars <span class="op">=</span> <span class="va">model.set</span><span class="op">[[</span><span class="va">model_index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">solution</span>, </span>
<span>                                    AIC <span class="op">=</span> <span class="va">model.set</span><span class="op">[[</span><span class="va">model_index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AIC</span><span class="op">)</span></span>
<span>    <span class="va">model.recons</span><span class="op">[[</span><span class="va">model_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">misse_recon</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>As with any other function contained within <code>hisse</code>, the
output from the character reconstruction can be used to obtain model
averaged rates, such the estimated rates for each tip in the tree:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tip.rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelAveRates.html">GetModelAveRates</a></span><span class="op">(</span><span class="va">model.recons</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tips"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We recommend also taking a look at the function
<code>generateMiSSEFGreedyCombinations()</code>, which we used in the
<code><a href="../reference/MiSSEGreedy.html">MiSSEGreedy()</a></code> example above. This creates the set of
combinations of models to run through <code><a href="../reference/MiSSEGreedy.html">MiSSEGreedy()</a></code> as a
data.frame. It has columns for the number of rates to estimate for
turnover, the number of values to estimate for extinction fraction
(eps), and any fixed values for eps to apply to the whole tree. You can
add your own rows or delete some to this data.frame to add more or fewer
combinations. By default, this comes out ordered so that simpler models
are run first in <code><a href="../reference/MiSSEGreedy.html">MiSSEGreedy()</a></code> but that is not required
(but wise for most use cases), and you can reorder if you wish.
<code>turnover.tries</code> and <code>eps.tries</code> set how many
turnover and eps hidden states to try, respectively. If you wanted to
try only 1, 3, and 7 hidden states for turnover you would set
<code>turnover.tries = c(1, 3, 7)</code> for example.</p>
<p>As discussed above estimating extinction rates is hard. This affects
all diversification models (even if all you want and look at is
speciation rate, extinction rate estimates still affect what this is as
they affect the likelihood). It is most noticeable in MiSSE with eps,
the extinction fraction (extinction rate divided by speciation rate).
One option, following Magallon &amp; Sanderson (2001), is to set
extinction fraction at set values. By default, we use the somewhat
arbitrary values of Magallon &amp; Sanderson (2001) – 0 (meaning a Yule
model - no extinction) or 0.9 (a lot of extinction, though still less
than paleontoligists find). You can set your own in
<code>fixed.eps.tries</code>. If you only want to use fixed values, and
not estimate, get rid of the NA, as well. However, don’t “cheat” – if
you use a range of values for fixed.eps, it’s basically doing a search
for this, though the default AICc calculation doesn’t “know” this to
penalize it for another parameter.</p>
<p><code>HiSSE</code> and, by extension, <code>MiSSE</code> assume that
a taxon has a particular hidden state. Thus, they’re written to assume
that we “paint” these states on the tree and a given state affects both
turnover and eps. So if turnover has four hidden states, eps has four
hidden states. They can be constrained: the easiest way is to have, say,
turnover having an independent rate for each hidden state and eps having
the same rate for all the hidden states. If <code>vary.both</code> is
set to FALSE, all models are of this sort: if turnover varies, eps is
constant across all hidden states, or vice versa. Jeremy Beaulieu
prefers this. If <code>vary.both</code> is set to TRUE, both can vary:
for example, there could be five hidden states for both turnover and
eps, but turnover lets each of these have a different rate, but eps only
allows three values (so that eps_A and eps_D might be forced to be
equal, and eps_B and eps_E might be forced to be equal). Brian O’Meara
would consider allowing this, while cautioning you about the risks of
too many parameters.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Beaulieu, J.M., and B.C. O’Meara. (2016). Detecting hidden
diversification shifts in models of trait-dependent speciation and
extinction. Syst. Biol. 65:583-601.</p>
<p>Caetano, D.S., B.C. O’Meara, and J.M. Beaulieu. (2018). Hidden state
models improve state-dependent diversification approaches, including
biogeographic models. Evolution, 72:2308-2324.</p>
<p>Magallón, S, and M.J. Sanderson. (2001). Absolute diversification
rates in angiosperm clades. Evolution 55:1762-1780.</p>
<p>Nakov, T., J.M. Beaulieu, and A.J. Alverson. (2018). Freshwater
diatoms diversify faster than marine in both planktonic and benthic
habitats. bioRxiv, doi: <a href="https://doi.org/10.1101/406165" class="external-link uri">https://doi.org/10.1101/406165</a>.</p>
<p>Rabosky, D.L., and E.E. Goldberg. (2015). Model inadequacy and
mistaken inferences of trait-dependent speciation. Syst. Biol.
64:340-355.</p>
<p>Steeman, M.E., B.M.B. Hebsgaard, E. Fordyce, S.Y.W. Ho, D.L. Rabosky,
R. Nielsen, C. Rahbek, H. Glenner, M.V. Sorensen, and E. Willerslev.
2009. Radiation of extant cetaceans driven by restructuring of the
oceans. Syst. Biol. 58:573-585.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Beaulieu, Brian O’Meara, Daniel Caetano, James Boyko, Thais Vasconcelos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
