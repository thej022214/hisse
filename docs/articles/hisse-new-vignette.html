<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A newer, faster HiSSE function • hisse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A newer, faster HiSSE function">
<meta property="og:description" content="hisse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hisse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Clade-specific-sampling.html">The Problem with Clade-specific Sampling Fractions</a>
    </li>
    <li>
      <a href="../articles/GeoHiSSE-vignette.html">Running GeoHiSSE</a>
    </li>
    <li>
      <a href="../articles/MiSSE-vignette.html">Running MiSSE</a>
    </li>
    <li>
      <a href="../articles/MuHiSSE-vignette.html">Running a Multistate HiSSE model</a>
    </li>
    <li>
      <a href="../articles/adding_fossils.html">Incorporating Fossils in HiSSE, MuHiSSE, and MiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-fisse-type1-vignette.html">Type I errors, Model rejection, &amp; HiSSE vs. FiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-new-vignette.html">A newer, faster HiSSE function</a>
    </li>
    <li>
      <a href="../articles/hisse-vignette.html">Running the old HiSSE function</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A newer, faster HiSSE function</h1>
                        <h4 data-toc-skip class="author">Jeremy M.
Beaulieu</h4>
            
      
      
      <div class="hidden name"><code>hisse-new-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>As of version 1.9.6, we now provide a new set of functions that
execute a faster version of the HiSSE model described by Beaulieu and
O’Meara (2016). Here we implement a more efficient means of carrying out
branch calculations, so it is exceptionally faster than in previous
versions. Specifically, we break up the tree into sets of branches whose
branch calculations are independent of one another. We then carry out
all descendent branch calculations simultaneously, combine the
probabilities based on their shared ancestry, then repeat for the next
set of descendent branches. In testing, we’ve found that as the number
of taxa increases, the calculation becomes much more efficient. Another
main differences here is that the new <code><a href="../reference/hisse.html">hisse()</a></code> function
allows up to four hidden categories, which means that both the
character-independent model (<code>hisse.null4()</code>) is no longer a
standalone function and can be set up directly in the same way as we can
setup a BiSSE, HiSSE, or CID-2 models. It is our hope that this will
emphasize to users the direct connection between BiSSE, HiSSE, and our
CID models.</p>
<p>Below I will demonstrate how to set up various models, and how the
likelihoods compare against those from <code>diversitree</code> whenever
possible. Before getting started, be sure to load the <code>hisse</code>
and <code>diversitree</code> packages:</p>
<pre><code><span><span class="co">## Loading required package: ape</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: deSolve</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenSA</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: subplex</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: nloptr</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="simulating-a-practice-data-set">Simulating a practice data set<a class="anchor" aria-label="anchor" href="#simulating-a-practice-data-set"></a>
</h2>
<p>I will first simulate data using the multistate (MuSSE) model that
can be used to create a binary character that has a relation to a
“hidden” state:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.zoology.ubc.ca/prog/diversitree/" class="external-link">diversitree</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># Essentially we are setting up a model that models the evolution of two binary characters</span></span>
<span><span class="co"># Thus, we are assuming the following state combinations 1=00, 2=10, 3=01, 4=11:</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/diversitree/man/simulate.html" class="external-link">tree.musse</a></span><span class="op">(</span><span class="va">pars</span>, max.taxa<span class="op">=</span><span class="fl">50</span>, x0<span class="op">=</span><span class="fl">1</span>, include.extinct<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">sim.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span><span class="op">)</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span><span class="op">)</span></span>
<span><span class="co"># Now we want to make the states associated with the second character hidden from us. So, </span></span>
<span><span class="co"># we remove states 3 and 4 and make them 1 and 2</span></span>
<span><span class="va">sim.dat</span><span class="op">[</span><span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">sim.dat</span><span class="op">[</span><span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="co"># This next step simply forces the character to be binary:</span></span>
<span><span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-a-bisse-model-using-hisse">Setting up a BiSSE model using HiSSE<a class="anchor" aria-label="anchor" href="#setting-up-a-bisse-model-using-hisse"></a>
</h2>
<p>As with the original HiSSE implementation (see
<code><a href="../reference/hisse.old.html">hisse.old()</a></code>), the number of free parameters in the model
for both turnover and extinction fraction are specified as index vectors
provided to the function call. Each vector contains four entries that
correspond to rates associated with the observed states (0 or 1) and the
hidden states (A or B). They are always ordered as follows for a given
hidden state, <span class="math inline">\(i\)</span>: <span class="math inline">\(0_i\)</span>, <span class="math inline">\(1_i\)</span>. However, in this case we do not want
any hidden states. But first let’s set up the “dull null” – i.e.,
turnover and extinction fraction are the same for both states. Note the
“f” represents the sampling fraction for each observed state
combination, which is a vector ordered in the same manner as for
turnover and extinction fraction vectors:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">extinction.fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Next, we have to set up a transition matrix. There is a function
provided to make this easy, and allows users to customize the matrix to
fit particular hypotheses. Be sure to look at the options on this
function call, for allowing diagonals and for customizing the matrix
when you have character independent model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates.bisse</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/transMatMakerHiSSE.html">TransMatMakerHiSSE</a></span><span class="op">(</span>hidden.traits<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trans.rates.bisse</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     (0) (1)</span></span>
<span><span class="co">## (0)  NA   2</span></span>
<span><span class="co">## (1)   1  NA</span></span></code></pre>
<p>Now, we can call HiSSE and estimate the parameters under this model
using the default settings:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dull.null</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hisse.html">hisse</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">phy</span>, data<span class="op">=</span><span class="va">sim.dat</span>, f<span class="op">=</span><span class="va">f</span>, turnover<span class="op">=</span><span class="va">turnover</span>, </span>
<span>                     eps<span class="op">=</span><span class="va">extinction.fraction</span>, hidden.states<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                     trans.rate<span class="op">=</span><span class="va">trans.rates.bisse</span><span class="op">)</span></span></code></pre></div>
<p>If you wanted to set up a true BiSSE model, where the turnover rate
parameters are unlinked across the observed state combinations, you
would simply do the following:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">extinction.fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">BiSSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hisse.html">hisse</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">phy</span>, data<span class="op">=</span><span class="va">sim.dat</span>, f<span class="op">=</span><span class="va">f</span>, turnover<span class="op">=</span><span class="va">turnover</span>, </span>
<span>                     eps<span class="op">=</span><span class="va">extinction.fraction</span>, hidden.states<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                     trans.rate<span class="op">=</span><span class="va">trans.rates.bisse</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-a-hisse-model">Setting up a HiSSE model<a class="anchor" aria-label="anchor" href="#setting-up-a-hisse-model"></a>
</h2>
<p>Setting up a character-dependent HiSSE model is relatively
straightforward, and relies on all the same tools as above. One
important thing to bear in mind, is that again, the states are ordered
by state combination within each hidden state. For example, if you want
two hidden states, A and B, the order of the parameters in the model is
0A, 1A, 0B, and 1B. So, in this case, we just need to specify the free
parameters we want for diversification. Here we are just going assume
turnover varies across the different states:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">extinction.fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span> </span>
<span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We also have to extend the transition rate matrix. This is done by
specifying the number of hidden states:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rate.hisse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transMatMakerHiSSE.html">TransMatMakerHiSSE</a></span><span class="op">(</span>hidden.traits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trans.rate.hisse</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    2    5   NA</span></span>
<span><span class="co">## (1A)    1   NA   NA    5</span></span>
<span><span class="co">## (0B)    5   NA   NA    4</span></span>
<span><span class="co">## (1B)   NA    5    3   NA</span></span></code></pre>
<p>Now, we can just plug these options into MuHiSSE:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HiSSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hisse.html">hisse</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">phy</span>, data<span class="op">=</span><span class="va">sim.dat</span>, f<span class="op">=</span><span class="va">f</span>, turnover<span class="op">=</span><span class="va">turnover</span>, </span>
<span>                     eps<span class="op">=</span><span class="va">extinction.fraction</span>, hidden.states<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                     trans.rate<span class="op">=</span><span class="va">trans.rate.hisse</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-a-character-independent-hisse-model-i-e--cid-2-cid-4">Setting up a character-independent HiSSE model (i.e., CID-2,
CID-4)<a class="anchor" aria-label="anchor" href="#setting-up-a-character-independent-hisse-model-i-e--cid-2-cid-4"></a>
</h2>
<p>Remember, for any character-independent model, the diversification
rates <em>must</em> be decoupled from the observed states. So, to do
this, we simply set the diversification rates to be equal for all states
for a given hidden state. Below, I will show how to do this for a
character-independent model with two rate shifts in the tree, what we
refer to as the CID-2 model:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">extinction.fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span> </span>
<span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">trans.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transMatMakerHiSSE.html">TransMatMakerHiSSE</a></span><span class="op">(</span>hidden.traits<span class="op">=</span><span class="fl">1</span>, make.null<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>For the transition rate matrix, I included a setting called
<code>make.null</code> that simply replicates the transition model
across the hidden states. This way the transition rates are not impacted
by changes in the diversification rate regime – that is, <span class="math inline">\(q_{0,A\rightarrow 1,A} = q_{1,B\rightarrow
0,B}\)</span>.</p>
<p>Here is a how you would set up the diversification rates for models
with three hidden state, which is equivalent to CID-4 model:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">extinction.fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span> </span>
<span><span class="va">trans.rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transMatMakerHiSSE.html">TransMatMakerHiSSE</a></span><span class="op">(</span>hidden.traits<span class="op">=</span><span class="fl">3</span>, make.null<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="some-considerations-regarding-optimization">Some considerations regarding optimization<a class="anchor" aria-label="anchor" href="#some-considerations-regarding-optimization"></a>
</h2>
<p>We’ve done our best to ensure that the results obtain from
<code><a href="../reference/hisse.html">hisse()</a></code> and other functions (<code><a href="../reference/MuHiSSE.html">MuHiSSE()</a></code>,
<code><a href="../reference/GeoHiSSE.html">GeoHiSSE()</a></code>, and <code><a href="../reference/MiSSE.html">MiSSE()</a></code>) are reliable and at
their MLE <em>most</em> of the time. Like any likehood-based comparative
method, there will be times where the optimizer might terminate early,
when the starting values put the optimizer on a track to get stuck on a
suboptimal local peak. There will even be times will be times when the
branch calculations will fail and return nonsensical results. We
implemented checks internally throughout to catch some of these issue
when they arise. However, to ensure a robust parameter search we’ve now
made the two-step (<code>sann=TRUE</code>) optimization routine as the
default for all functions within hisse. This first step involves a
simulated annealing (SA) optimization routine. An SA algorithm is
basically hill-climbing that is ideal for navigating likelihood surfaces
that have many local peaks to find the global peak. The algorithm works
by not always picking the best move, but rather a random move. If the
selected move improves the solution, then it is always accepted. If not,
the algorithm makes the move anyway with some probability less than 1.
The probability decreases exponentially with how bad a move is scaled by
the “temperature” of the chain. At higher temperatures bad moves are
more likely, and at lower temperatures bad moves are less likely. The
second step of our routine refines the SA search using the standard
subplex routine that used to be the default. That is, the starting
values in step 2 are the ML parameter estimates from the SA search.
Users can, of course, revert back to the original “fast and loose”
optimization routine by simply doing <code>sann=FALSE</code>.</p>
<p>There are other considerations that users should make when evaluating
the robustness of their results. For instance, if users choose
<code>sann=FALSE</code>, does the choice of starting values impact the
results? If so, then it might be worth trying a large set of starting
values to find the set that produces the best likelihood. Also, to
increase speed, it might be wise to reduce the size of the bounds. Right
now the bounds on turnover (<code>turnover.upper</code>) and transition
rates (<code>trans.upper</code>) are set pretty high. Shrinking the
bounds will limit the optimizer from spending time in really bad areas
of parameter space.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Beaulieu, J.M., and B.C. O’Meara. (2016). Detecting hidden
diversification shifts in models of trait-dependent speciation and
extinction. Syst. Biol. 65:583-601.</p>
<p>FitzJohn R.G. 2012. Diversitree: comparative phylogenetic analyses of
diversification in R. Methods in Ecology and Evolution 3:1084-1092.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Beaulieu, Brian O’Meara, Daniel Caetano, James Boyko, Thais Vasconcelos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
