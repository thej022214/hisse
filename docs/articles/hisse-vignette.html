<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running the old HiSSE function • hisse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running the old HiSSE function">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hisse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.13</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adding_fossils.html">Incorporating Fossils in HiSSE, MuHiSSE, and MiSSE</a>
    </li>
    <li>
      <a href="../articles/Clade-specific-sampling.html">The Problem with Clade-specific Sampling Fractions</a>
    </li>
    <li>
      <a href="../articles/GeoHiSSE-vignette.html">Running GeoHiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-fisse-type1-vignette.html">Type I errors, Model rejection, &amp; HiSSE vs. FiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-new-vignette.html">A newer, faster HiSSE function</a>
    </li>
    <li>
      <a href="../articles/hisse-vignette.html">Running the old HiSSE function</a>
    </li>
    <li>
      <a href="../articles/MiSSE-vignette.html">Running MiSSE</a>
    </li>
    <li>
      <a href="../articles/MuHiSSE-vignette.html">Running a Multistate HiSSE model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running the old HiSSE function</h1>
                        <h4 data-toc-skip class="author">Jeremy M.
Beaulieu</h4>
            
      

      <div class="hidden name"><code>hisse-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>As of version 1.9.6, we now provide a new set of functions that
execute more complex and potentially faster version of the HiSSE model
described by Beaulieu and O’Meara (2016). One of the main differences
here is that the model allows up to 8 hidden categories, which means
that both the character-independent model (hisse.null4) is called from
the same function as the BiSSE and HiSSE models. We also implement a
more efficient means of carrying out branch calculations, so it is
exceptionally faster than in previous versions. Nevertheless, we have
maintained the original implementation of the hisse model, and we have
kept this tutorial to gives some basic information on how to set up and
execute the original hisse function. For information about how to use
the new <code><a href="../reference/hisse.html">hisse()</a></code> function see the <em>A newer, faster HiSSE
function</em> vignette. We highly recommend you use the newer
version.</p>
<p>Before getting started, be sure to load the hisse package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hisse</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: ape</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: deSolve</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenSA</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: subplex</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: nloptr</span></span></code></pre>
<p>And also be sure to load diversitree. We can simulate data using the
multistate (MuSSE) model that can be used to create a binary character
that has a relation to a “hidden” state:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.zoology.ubc.ca/prog/diversitree/" class="external-link">diversitree</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># Essentially we are setting up a model that models the evolution of two binary characters</span></span>
<span><span class="co"># Thus, we are assuming the following state combinations 1=00, 2=10, 3=01, 4=11:</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/diversitree/man/simulate.html" class="external-link">tree.musse</a></span><span class="op">(</span><span class="va">pars</span>, max.taxa<span class="op">=</span><span class="fl">50</span>, x0<span class="op">=</span><span class="fl">1</span>, include.extinct<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">sim.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span><span class="op">)</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span><span class="op">)</span></span>
<span><span class="co"># Now we want to make the states associated with the second character hidden from us. So, </span></span>
<span><span class="co"># we remove states 3 and 4 and make them 1 and 2</span></span>
<span><span class="va">sim.dat</span><span class="op">[</span><span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">sim.dat</span><span class="op">[</span><span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="co"># This next step simply forces the character to be binary:</span></span>
<span><span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">sim.dat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span></span></code></pre></div>
<p>In the end you have a data set that has a single binary
character:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim.dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      names.phy.tip.state. phy.tip.state</span></span>
<span><span class="co">## sp3                   sp3             1</span></span>
<span><span class="co">## sp10                 sp10             1</span></span>
<span><span class="co">## sp12                 sp12             0</span></span>
<span><span class="co">## sp17                 sp17             0</span></span>
<span><span class="co">## sp18                 sp18             1</span></span>
<span><span class="co">## sp19                 sp19             0</span></span></code></pre>
<p>However, this binary character has actually evolved under a much more
complex process than what would be reflected by estimates from a BiSSE
model. It is this complexity that HiSSE is trying estimate.</p>
<p>##Specifying the diversification parameters Rather than optimizing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>
separately, hisse optimizes transformations of these variables. Here we
let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>τ</mi><mi>i</mi></msub><mo>=</mo><msub><mi>λ</mi><mi>i</mi></msub><mo>+</mo><msub><mi>μ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\tau_i = \lambda_i+\mu_i</annotation></semantics></math>
define “net turnover”, and we let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>i</mi></msub><mo>=</mo><msub><mi>μ</mi><mi>i</mi></msub><mi>/</mi><msub><mi>λ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\epsilon_i = \mu_i / \lambda_i</annotation></semantics></math>
define the “extinction fraction”. This reparameterization alleviates
problems associated with over-fitting when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>
are highly correlated, but both matter in explaining the diversity
pattern (see discussion of this issue in Beaulieu and O’Meara 2016). The
number of free parameters in the model for both net turnover and
extinction fraction are specified as index vectors provided to the
function call. Each vector contains four entries that correspond to
rates associated with the observed states (0 or 1) and the hidden states
(A or B). They are ordered as follows: 0A, 1A, 0B, 1B. Note that the
index vector can also be set up such that parameters are linked among
states or even dropped from the model entirely.</p>
<p>Let’s walk through a couple of examples. Take, for instance, the
following index vectors:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">eps.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>In this example, turnover.anc has a single free parameter for both 0A
and 1A state combinations; there is a single free parameter for
extinction fraction. This is equivalent to a BiSSE model with a fixed
turnover and extinction rates across the observed states 0 an 1. Now,
say we want to include separate turnover rates for both states 0A and
1A:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Thus, a full hisse model would thus be,</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>which corresponds to four separate net turnover rates for 1=0A, 2=1A,
3=0B, 4=1B. Extinction fraction, needless to say, follows the same
format, though including a zero for a state we want to include in the
model corresponds to no extinction, which is the Yule (pure birth)
equivalent:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eps.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Fairly straightforward, but why do we do it this way? This particular
format makes it easier to generate a large set of nested models to test.
We now include an internal function <code>GetAllModels.anc()</code> that
provides all possible combinations of free parameters nested within the
full hisse model.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-transition-rate-matrix">Setting up the transition rate matrix<a class="anchor" aria-label="anchor" href="#setting-up-the-transition-rate-matrix"></a>
</h2>
<p>The transition rate matrix is set up separate from the
diversification rate parameters. This was intentional. We want to
reinforce the idea that SSE models are not trait evolution models, but
rather joint models for the tree and the evolution of a trait. It for
this reason that we depict the transition rates in the canonical
<strong>Q</strong> matrix format.</p>
<p>To generate the index matrix describing the free parameters in the
transition model, we use the <code>TransMatMaker()</code> function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">TransMatMaker.old</a></span><span class="op">(</span>hidden.states<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">trans.rates</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    4    7   10</span></span>
<span><span class="co">## (1A)    1   NA    8   11</span></span>
<span><span class="co">## (0B)    2    5   NA   12</span></span>
<span><span class="co">## (1B)    3    6    9   NA</span></span></code></pre>
<p>Note that the default matrix contains 12 free parameters, which
includes dual transitions between both the observed trait and the hidden
trait (e.g., q0A&lt;-&gt;q1B). Personally, I’m skeptical about such
transitions and always remove them from the model entirely. I accomplish
this by using the internal function <code><a href="../reference/transMat.html">ParDrop()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates.nodual</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">ParDrop</a></span><span class="op">(</span><span class="va">trans.rates</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">8</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    3    5    0</span></span>
<span><span class="co">## (1A)    1   NA    0    7</span></span>
<span><span class="co">## (0B)    2    0   NA    8</span></span>
<span><span class="co">## (1B)    0    4    6   NA</span></span></code></pre>
<p>You may also want to run a model where we assume all transitions are
equal to one another. This will often be a sensible approach because it
is generally difficult to reasonably estimate the transition rates (see
Beaulieu and O’Meara 2016). To set the rates equal we can use another
internal function, <code><a href="../reference/transMat.html">ParEqual()</a></code>. This function takes pairs of
indexes and sets the two equal based on the index of the first entry.
Take our example above and let’s set parameter 1 and 6 to have the same
rate:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates.nodual.equal16</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">ParEqual</a></span><span class="op">(</span><span class="va">trans.rates.nodual</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.equal16</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    3    5    0</span></span>
<span><span class="co">## (1A)    1   NA    0    6</span></span>
<span><span class="co">## (0B)    2    0   NA    7</span></span>
<span><span class="co">## (1B)    0    4    1   NA</span></span></code></pre>
<p>Note that the index for parameter 6 has become 1 – in other words,
their rate will take the same value. Now, let’s set all rates to be
equal using this function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates.nodual.allequal</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">ParEqual</a></span><span class="op">(</span><span class="va">trans.rates.nodual</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">1</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.allequal</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    1    1    0</span></span>
<span><span class="co">## (1A)    1   NA    0    1</span></span>
<span><span class="co">## (0B)    1    0   NA    1</span></span>
<span><span class="co">## (1B)    0    1    1   NA</span></span></code></pre>
<p>Here we’ve set the index 2 to equal 1, 3 to equal 1, 4 to equal 1,
etc. Of course, if this function is confusing, there are other ways to
do the same thing. For example, one could do:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates.nodual.allequal</span> <span class="op">=</span> <span class="va">trans.rates.nodual</span></span>
<span><span class="va">trans.rates.nodual.allequal</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trans.rates.nodual.allequal</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                              <span class="op">!</span><span class="va">trans.rates.nodual.allequal</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">trans.rates.nodual.allequal</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    1    1    0</span></span>
<span><span class="co">## (1A)    1   NA    0    1</span></span>
<span><span class="co">## (0B)    1    0   NA    1</span></span>
<span><span class="co">## (1B)    0    1    1   NA</span></span></code></pre>
<p>Also note that in order to run a BiSSE model in HiSSE, the matrix set
up would look like this:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates.bisse</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">TransMatMaker.old</a></span><span class="op">(</span>hidden.states<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">trans.rates.bisse</span></span></code></pre></div>
<pre><code><span><span class="co">##     (0) (1)</span></span>
<span><span class="co">## (0)  NA   2</span></span>
<span><span class="co">## (1)   1  NA</span></span></code></pre>
<p>Whatever transition matrix is designed, it is supplied to the
<code>trans.rate=</code> argument in the <code><a href="../reference/hisse.html">hisse()</a></code> call:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp</span> <span class="op">=</span> <span class="fu"><a href="../reference/hisse.old.html">hisse.old</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">sim.dat</span>, f<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, hidden.states<span class="op">=</span><span class="cn">TRUE</span>, turnover.anc<span class="op">=</span><span class="va">turnover.anc</span>, </span>
<span>           eps.anc<span class="op">=</span><span class="va">eps.anc</span>, trans.rate<span class="op">=</span><span class="va">trans.rates.nodual.allequal</span>, sann<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-common-mistake">A common mistake<a class="anchor" aria-label="anchor" href="#a-common-mistake"></a>
</h2>
<p>I wanted to highlight a common mistake I’ve seen through my email
correspondence with several users. It may be of interest to test a model
where the hidden state is associated with only a single observed state,
such that the model contains states 0A, 1A, and 1B. The diversification
parameters might look something like this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">eps.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The 0 in the 3rd entry for state 0B designates that the parameter is
removed entirely from the model. A common mistake is that the
transitions to and from 0B are not removed from the transition matrix.
This needs to be done manually:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transMat.html">TransMatMaker.old</a></span><span class="op">(</span>hidden.states<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.no0B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transMat.html">ParDrop</a></span><span class="op">(</span><span class="va">trans.rates</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.no0B</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    2    0    0</span></span>
<span><span class="co">## (1A)    1   NA    0    4</span></span>
<span><span class="co">## (0B)    0    0   NA    0</span></span>
<span><span class="co">## (1B)    0    3    0   NA</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="changing-the-output">Changing the output<a class="anchor" aria-label="anchor" href="#changing-the-output"></a>
</h2>
<p>By default, hisse outputs turnover and extinction fraction. I
recognize, of course, that this defies the convention of seeking to
estimate and interpretation differences in net diversification
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>i</mi></msub><mo>=</mo><msub><mi>λ</mi><mi>i</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">r_i = \lambda_i-\mu_i</annotation></semantics></math>).
Therefore, users can alter how the final parameters are printed to the
screen using the <code>output.type=</code> argument in the call
<code><a href="../reference/hisse.html">hisse()</a></code>. We’ve included three options: “turnover”,
“net.div”, and “raw”, which outputs the results as estimates of
speciation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math>)
and exinction
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>).
Thus, to output net diversification:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp</span> <span class="op">=</span> <span class="fu"><a href="../reference/hisse.old.html">hisse.old</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">sim.dat</span>, f<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, hidden.states<span class="op">=</span><span class="cn">TRUE</span>, turnover.anc<span class="op">=</span><span class="va">turnover.anc</span>, </span>
<span>           eps.anc<span class="op">=</span><span class="va">eps.anc</span>, trans.rate<span class="op">=</span><span class="va">trans.rates.nodual.allequal</span>, output.type<span class="op">=</span><span class="st">"net.div"</span>, sann<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-the-2-state-character-independent-cid-2-model">Setting up the 2-state character-independent (CID-2) model<a class="anchor" aria-label="anchor" href="#setting-up-the-2-state-character-independent-cid-2-model"></a>
</h2>
<p>In Beaulieu and O’Meara (2016), we proposed two character-independent
models as a means of providing a fairer comparison between
trait-dependent and trait-independent models of diversification (for
more details see the <em>Type I errors, Model rejection, &amp; HiSSE
vs. FiSSE</em> vignette). These character-independent (CID) models
explicitly assume that the evolution of a binary character is
independent of the diversification process without forcing the
diversification process to be constant across the entire tree. The first
model, which we refer to as “CID-2”, contains four diversification
process parameters that account for trait-dependent diversification
solely on the two states of an unobserved, hidden trait. In this way,
CID-2 contains the same amount of complexity in terms of diversification
as a BiSSE model. The second model, which we refer to as “CID-4”
contains the same number of diversification parameters as in the general
HiSSE model that are linked across four hidden states. In the case of
the CID=4 model, we have implemented a separate function,
<code>hisse.null4()</code> that should be fairly self-explanatory.
However, rather than implementing a separate function for the “CID-2”
model, we found it is easier to just set it up and test it using the
<code><a href="../reference/hisse.html">hisse()</a></code> function. This section describes how to do
this.</p>
<p>Remember, the goal is to set up a model where the diversification
process is independent from the observed states (0 or 1) of the focal
trait. In other words, diversification rate differences, if they exist,
will only be associated with one of the hidden states (A or B)
regardless of the state of the focal trait. Thus, the free parameters
for diversification would look like this:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">eps.anc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>In other words, we are specifying that both 0A and 1A have one set of
diversification rates, and 0B and 1B have another. That’s it. This is
the “null-two” model.</p>
<p>In regards to the transition rates, there are various ways in which
they can be set up. We could also assume all rates are equal:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans.rates</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">TransMatMaker.old</a></span><span class="op">(</span>hidden.states<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">ParDrop</a></span><span class="op">(</span><span class="va">trans.rates</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">8</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.allequal</span> <span class="op">=</span> <span class="fu"><a href="../reference/transMat.html">ParEqual</a></span><span class="op">(</span><span class="va">trans.rates.nodual</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">6</span>,<span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">1</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.allequal</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    1    1    0</span></span>
<span><span class="co">## (1A)    1   NA    0    1</span></span>
<span><span class="co">## (0B)    1    0   NA    1</span></span>
<span><span class="co">## (1B)    0    1    1   NA</span></span></code></pre>
<p>We could also specify three rates: one rate describing transitions
among the different hidden states (A&lt;-&gt;B, which could be
intrepreted as the rate by which shifts in diversification occur), and
two rates for transitions between the observed character states (0-&gt;1
or 1-&gt;0). Unfortunately, this requires a little bit of clunky
coding:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now we want three specific rates:</span></span>
<span><span class="va">trans.rates.nodual.threerates</span> <span class="op">&lt;-</span> <span class="va">trans.rates.nodual</span></span>
<span><span class="co"># Set all transitions from 0-&gt;1 to be governed by a single rate:</span></span>
<span><span class="va">to.change</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.threerates</span><span class="op">[</span><span class="va">to.change</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="co"># Now set all transitions from 1-&gt;0 to be governed by a single rate:</span></span>
<span><span class="va">to.change</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.threerates</span><span class="op">[</span><span class="va">to.change</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="co"># Finally, set all transitions between the hidden state to be a single rate (essentially giving </span></span>
<span><span class="co"># you an estimate of the rate by which shifts in diversification occur:</span></span>
<span><span class="va">to.change</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans.rates.nodual.threerates</span><span class="op">[</span><span class="va">to.change</span><span class="op">]</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="va">trans.rates.nodual.threerates</span></span></code></pre></div>
<pre><code><span><span class="co">##      (0A) (1A) (0B) (1B)</span></span>
<span><span class="co">## (0A)   NA    1    3    0</span></span>
<span><span class="co">## (1A)    2   NA    0    3</span></span>
<span><span class="co">## (0B)    3    0   NA    1</span></span>
<span><span class="co">## (1B)    0    3    2   NA</span></span></code></pre>
<p>As before, turnover.anc, eps.anc, and the transition rate matrix are
supplied as arguments to <code><a href="../reference/hisse.html">hisse()</a></code>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp</span> <span class="op">=</span> <span class="fu"><a href="../reference/hisse.old.html">hisse.old</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">sim.dat</span>, f<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, hidden.states<span class="op">=</span><span class="cn">TRUE</span>, turnover.anc<span class="op">=</span><span class="va">turnover.anc</span>, </span>
<span>           eps.anc<span class="op">=</span><span class="va">eps.anc</span>, trans.rate<span class="op">=</span><span class="va">trans.rates.nodual.allequal</span>, sann<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>and the results can be compared against any model in the hisse set,
including BiSSE.</p>
<p>##Plotting hisse reconstructions</p>
<p>Our HiSSE package provides plotting functionality in
<code><a href="../reference/plotHisse.html">plot.hisse.states()</a></code> for character state reconstructions of
<code>class hisse.states</code> output by our
<code><a href="../reference/marginRecon.old.html">MarginRecon.old()</a></code> function. Specifically, the function
provides an overlay of the state reconstructions on the rate estimates.
There are a couple of options for how these reconstructions to be
plotted. First, a single <code>hisse.states</code> object can be
supplied and it will provide a heat map of the diversification rate
parameter of choice. Users can choose among turnover, net
diversification (“net.div”), speciation, extinction, or extinction
fraction (“extinction.fraction”). I’ve provided example
<code>hisse.states</code> output from the example data set simulated
above. This particular model assumed two diversification rate parameters
– i.e., turnover.anc=c(1,1,1,2), and eps.anc=c(1,1,1,1). Let’s load this
file and check that everything has loaded correctly and is of the proper
<code>hisse.states</code> class:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pp.recon &lt;- MarginRecon.old(phy=phy, data=sim.dat, f = pp$f, pars = pp$solution</span></span>
<span><span class="co">#                         , hidden.states = pp$hidden.states, AIC = pp$AIC)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"testrecon1.Rsave"</span><span class="op">)</span> <span class="co"># Line above shows the command to create this result.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pp.recon</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "hisse.states"</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp.recon</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tip labels:</span></span>
<span><span class="co">##   sp15, sp57, sp58, sp49, sp50, sp42, ...</span></span>
<span><span class="co">## Node labels:</span></span>
<span><span class="co">##   1, 3, 1, 1, 1, 1, ...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Rooted; includes branch length(s).</span></span></code></pre>
<p>Now that we have the right files and information, let’s plot net
diversification rates:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHisse.html">plot.hisse.states</a></span><span class="op">(</span><span class="va">pp.recon</span>, rate.param<span class="op">=</span><span class="st">"net.div"</span>, show.tip.label<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="hisse-vignette_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<pre><code><span><span class="co">## $rate.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0.066161, 0.069176).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $state.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0, 1.001).</span></span></code></pre>
<p>These are the default colors: red to blue for rate and white to black
for state. However, other colors can be specified (see plot.hisse.states
manual). The legend in the bottom left corner provides the frequency of
the observed states (0 or 1) and the distribution of net diversification
rates at the tips only. Note that in this particular model I only
specified two diversification rate parameters [i.e.,
turnover.anc=c(1,1,1,2), and eps.anc=c(1,1,1,1)], and yet there seems to
be a continuous range of rates at the tips. What gives? Well, when a
single reconstruction is provided the rates painted on each branch are
the weighted average of the rate, with the marginal probability used as
the weights. So this particular painting has taken into account the
uncertainty in rates on each branch.</p>
<p>But, please be careful here! Notice that there are parts of the tree
that have much higher rates (denoted by bright red) than others (denoted
by darker blue). This is actually highly misleading. If you look at the
legend the rates span from 0.066 - 0.069! So, really, there aren’t any
meaningful differences in the diversification rates despite what the
painting may say. By default the visualization uses the minimum rate on
the tree for the minimum color, and the maximum rate for the maximum
color. However, users may want to use the same color scale across
models, even if some of them have a smaller range than others. A vector
with the minimum and maximum rate across all models can be passed to the
visualization:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHisse.html">plot.hisse.states</a></span><span class="op">(</span><span class="va">pp.recon</span>, rate.param<span class="op">=</span><span class="st">"net.div"</span>, show.tip.label<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                  rate.range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.072</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hisse-vignette_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<pre><code><span><span class="co">## $rate.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0, 0.072072).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $state.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0, 1.001).</span></span></code></pre>
<p>Now the differences completely disappear.</p>
<p>A really cool feature of the plotting function is that if you provide
a list of <code>hisse.states</code> objects the function will
“model-average” the results. In other words, branches are painted such
that they take into account both state and rate uncertainty and
uncertainty in the model. The <code><a href="../reference/plotHisse.html">plot.hisse.states()</a></code> first
calculates a weighted average of the likeliest state and rate
combination for every node and tip for each model in the set, using the
marginal probability as the weights, which are then averaged across all
models using the Akaike weights (i.e., the relative probability of a
model).</p>
<p>A first initial step when doing the modeling-averaging approach is to
make sure that the <code>hisse.states</code> objects contain the AIC
from the model fit embedded in it. The plotting function will not work
without it:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp.recon</span><span class="op">$</span><span class="va">AIC</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 364.8615</span></span></code></pre>
<p>If this returns a NULL, then something has gone wrong and you should
check how you performed the reconstructions. The AIC for the model can
be supplied as an argument in the <code><a href="../reference/marginRecon.old.html">MarginRecon.old()</a></code>
function (using the <code>pp</code> object we defined above):</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pp.recon</span> <span class="op">=</span> <span class="fu"><a href="../reference/marginRecon.old.html">MarginRecon.old</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">sim.dat</span>, f<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, hidden.states<span class="op">=</span><span class="cn">TRUE</span>, pars<span class="op">=</span><span class="va">pp</span><span class="op">$</span><span class="va">solution</span>, </span>
<span>                       AIC<span class="op">=</span><span class="va">pp</span><span class="op">$</span><span class="va">AIC</span>, n.cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>I’ve created two additional <code>hisse.states</code> objects that I
will use to demonstrate how to plot model-averaged states and rates: one
reconstruction is based on the null-two model [turnover.anc=c(1,1,2,2)],
and the other assumes four free turnover rates [i.e.,
turnover.anc=c(1,2,3,4)]; in all cases I assumed equal transition rates
and equal extinction fractions. I recognize that there are many ways to
generate a list. But here is one way, where I’m assuming that the
marginal reconstructions from three models are saved to the directory we
are working from:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hisse.results.list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"testrecon1.Rsave"</span><span class="op">)</span></span>
<span><span class="va">hisse.results.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">pp.recon</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"testrecon2.Rsave"</span><span class="op">)</span></span>
<span><span class="va">hisse.results.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">pp.recon</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"testrecon3.Rsave"</span><span class="op">)</span></span>
<span><span class="va">hisse.results.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">pp.recon</span></span>
<span><span class="co"># Now supply the list the plotting function</span></span>
<span><span class="fu"><a href="../reference/plotHisse.html">plot.hisse.states</a></span><span class="op">(</span><span class="va">hisse.results.list</span>, rate.param<span class="op">=</span><span class="st">"net.div"</span>, show.tip.label<span class="op">=</span><span class="cn">FALSE</span>, rate.range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.072</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hisse-vignette_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<pre><code><span><span class="co">## $rate.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0, 0.072072).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $state.tree</span></span>
<span><span class="co">## Object of class "contMap" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 50 tips and 49 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A mapped continuous trait on the range (0, 1.001).</span></span></code></pre>
<p>Although this is similar to the plot above, which shows no real rate
differences, it actually accounts for both the uncertainty in the model
as well as the reconstructions. Note that there are many features that
can be adjusted in <code><a href="../reference/plotHisse.html">plot.hisse.states()</a></code>, which is described
in detail in the manual.</p>
<p>Note that the above code is obviously a pretty lame way of generating
a list. An even easier way would be to do something like this:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, suck in all the files with .Rsave line ending in your working directory:</span></span>
<span><span class="co"># files = system("ls -1 | grep .Rsave", intern=TRUE) # This will not run in a Windows system.</span></span>
<span><span class="va">files</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span> pattern <span class="op">=</span> <span class="st">"*.Rsave"</span> <span class="op">)</span> <span class="co"># This is system independent.</span></span>
<span><span class="co"># Create an empty list object</span></span>
<span><span class="va">hisse.results.list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Now loop through all files, adding the embedded pp.recon object in each</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/sequence.html" class="external-link">sequence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">hisse.results.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">pp.recon</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">pp.recon</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Beaulieu, J.M., and B.C. O’Meara. (2016). Detecting hidden
diversification shifts in models of trait-dependent speciation and
extinction. Syst. Biol. 65:583-601.</p>
<p>FitzJohn R.G. 2012. Diversitree: comparative phylogenetic analyses of
diversification in R. Methods in Ecology and Evolution 3:1084-1092.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Beaulieu, Brian O’Meara, Daniel Caetano, James Boyko, Thais Vasconcelos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
