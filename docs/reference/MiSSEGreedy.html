<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Character-free State Speciation and Extinction Searching Greedily — MiSSEGreedy • hisse</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Character-free State Speciation and Extinction Searching Greedily — MiSSEGreedy"><meta property="og:description" content="Executes a set of MiSSE models (Missing State Speciation
 and Extinction) on a phylogeny, varying the number of parameters for turnover and extinction fraction and stopping when models stop being very good."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hisse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Clade-specific-sampling.html">The Problem with Clade-specific Sampling Fractions</a>
    </li>
    <li>
      <a href="../articles/GeoHiSSE-vignette.html">Running GeoHiSSE</a>
    </li>
    <li>
      <a href="../articles/MiSSE-vignette.html">Running MiSSE</a>
    </li>
    <li>
      <a href="../articles/MuHiSSE-vignette.html">Running a Multistate HiSSE model</a>
    </li>
    <li>
      <a href="../articles/adding_fossils.html">Incorporating Fossils in HiSSE, MuHiSSE, and MiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-fisse-type1-vignette.html">Type I errors, Model rejection, &amp; HiSSE vs. FiSSE</a>
    </li>
    <li>
      <a href="../articles/hisse-new-vignette.html">A newer, faster HiSSE function</a>
    </li>
    <li>
      <a href="../articles/hisse-vignette.html">Running the old HiSSE function</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Character-free State Speciation and Extinction Searching Greedily</h1>
    
    <div class="hidden name"><code>MiSSEGreedy.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Executes a set of MiSSE models (Missing State Speciation
 and Extinction) on a phylogeny, varying the number of parameters for turnover and extinction fraction and stopping when models stop being very good.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MiSSEGreedy</span><span class="op">(</span><span class="va">phy</span>, f<span class="op">=</span><span class="fl">1</span>, possible.combos <span class="op">=</span> </span>
<span><span class="fu"><a href="generateMiSSEGreedyCombinations.html">generateMiSSEGreedyCombinations</a></span><span class="op">(</span>shuffle.start<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, stop.deltaAICc<span class="op">=</span><span class="fl">10</span>, save.file<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>n.cores<span class="op">=</span><span class="cn">NULL</span>, chunk.size<span class="op">=</span><span class="fl">10</span>, check.fits<span class="op">=</span><span class="cn">FALSE</span>, remove.bad<span class="op">=</span><span class="cn">FALSE</span>, n.tries<span class="op">=</span><span class="fl">2</span>, </span>
<span>condition.on.survival<span class="op">=</span><span class="cn">TRUE</span>, root.type<span class="op">=</span><span class="st">"madfitz"</span>, root.p<span class="op">=</span><span class="cn">NULL</span>, includes.fossils<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>k.samples<span class="op">=</span><span class="cn">NULL</span>, strat.intervals<span class="op">=</span><span class="cn">NULL</span>, sann<span class="op">=</span><span class="cn">TRUE</span>, sann.its<span class="op">=</span><span class="fl">5000</span>, sann.temp<span class="op">=</span><span class="fl">5230</span>, </span>
<span>sann.seed<span class="op">=</span><span class="op">-</span><span class="fl">100377</span>,bounded.search<span class="op">=</span><span class="cn">TRUE</span>, max.tol<span class="op">=</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">^</span><span class="fl">.50</span>, </span>
<span>starting.vals<span class="op">=</span><span class="cn">NULL</span>, turnover.upper<span class="op">=</span><span class="fl">10000</span>, eps.upper<span class="op">=</span><span class="fl">3</span>, trans.upper<span class="op">=</span><span class="fl">100</span>, restart.obj<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>ode.eps<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>phy</dt>
<dd><p>a phylogenetic tree, in <code>ape</code> “phylo” format. If <code>includes.fossils=TRUE</code> then the input phy object must include extinct tips.</p></dd>

<dt>f</dt>
<dd><p>the estimated proportion of extant species included in the phylogeny. A value of
  0.50 means that 50 percent of species are contained in the. By default all species are assumed
  to be sampled.</p></dd>

<dt>possible.combos</dt>
<dd><p>data.frame of parameter combinations to try. See 'Details'.</p></dd>

<dt>stop.deltaAICc</dt>
<dd><p>how bad compared to the best does a model have to be to far enough outside we stop looking at even more complex ones?</p></dd>

<dt>save.file</dt>
<dd><p>file to use to save results while the code is running</p></dd>

<dt>n.cores</dt>
<dd><p>how many cores to run this on in parallel</p></dd>

<dt>chunk.size</dt>
<dd><p>how many models to run before checking to make sure there are no improvements. See 'Details'.</p></dd>

<dt>check.fits</dt>
<dd><p>a logical indicating whether a secondary check to ensure optimization performed well. See <code>FindAndRerun</code></p></dd>

<dt>remove.bad</dt>
<dd><p>a logical indicating whether bad models identified as poorly fit should be removed. Only invoked when <code>FindAndRerun=TRUE</code>.</p></dd>

<dt>n.tries</dt>
<dd><p>maximum number of retries for a given model when <code>check.fits=TRUE</code>.</p></dd>

<dt>condition.on.survival</dt>
<dd><p>a logical indicating whether the likelihood
  should be conditioned on the survival of two lineages and the
  speciation event subtending them (Nee et al. 1994). The default is <code>TRUE</code>.</p></dd>

<dt>root.type</dt>
<dd><p>indicates whether root summarization follow the procedure described by FitzJohn et al. 2009, “madfitz” or Herrera-Alsina et al. 2018, “herr_als”.</p></dd>

<dt>root.p</dt>
<dd><p>a vector indicating fixed root state probabilities. The default is <code>NULL</code>.</p></dd>

<dt>includes.fossils</dt>
<dd><p>a logical indicating whether the tree contains fossil taxa. The default is <code>FALSE</code>.</p></dd>

<dt>k.samples</dt>
<dd><p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p></dd>

<dt>strat.intervals</dt>
<dd><p>a table of extinct individuals with sampled descendants. See vignette for how the table must be formatted.</p></dd>

<dt>sann</dt>
<dd><p>a logical indicating whether a two-step optimization
  procedure is to be used. The first includes a simulate annealing
  approach, with the second involving a refinement using
  <code>subplex</code>. The default is <code>TRUE</code>.</p></dd>

<dt>sann.its</dt>
<dd><p>a numeric indicating the number of times the simulated
  annealing algorithm should call the objective function.</p></dd>

<dt>sann.temp</dt>
<dd><p>the starting temperature for the simulated annealing. Higher temperatures results in the chain sampling a much wider space initially. The default of 5320 is based on the default of the GenSA package. For larger trees setting this value higher in conjunction with more sann.its can drastically improve performance.</p></dd>

<dt>sann.seed</dt>
<dd><p>the seed number for the simulated annealing algorithm. This value must be negative and an odd number.</p></dd>

<dt>bounded.search</dt>
<dd><p>a logical indicating whether or not bounds should
  be enforced during optimization. The default is <code>TRUE</code>.</p></dd>

<dt>max.tol</dt>
<dd><p>supplies the relative optimization tolerance to
  <code>subplex</code>.</p></dd>

<dt>starting.vals</dt>
<dd><p>a numeric vector of length 3 with starting values for the
  model. Position [1] sets turnover, [2] sets extinction fraction, and
  [3] transition rates between distinct diversification rates.</p></dd>

<dt>turnover.upper</dt>
<dd><p>sets the upper bound for the turnover parameters.</p></dd>

<dt>eps.upper</dt>
<dd><p>sets the upper bound for the eps parameters.</p></dd>

<dt>trans.upper</dt>
<dd><p>sets the upper bound for the transition rate parameters.</p></dd>

<dt>restart.obj</dt>
<dd><p>an object of class  that contains everything to restart an optimization.</p></dd>

<dt>ode.eps</dt>
<dd><p>sets the tolerance for the integration at the end of a
  branch. Essentially if the sum of compD is less than this tolerance,
  then it assumes the results are unstable and discards them. The
  default is set to zero, but in testing a value of 1e-8 can sometimes
  produce stable solutions for both easy and very difficult optimization problems.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>MiSSEGreedy</code> returns a list of class <code>misse.fit</code> objects.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>See the <code>MiSSE</code> function for description of the method overall. It requires a set number of hidden state categories, but finding the best number of categories can be hard. For example, one could 1 to 26 different turnover categories and 1 to 26 possible extinction fraction categories. For most cases, we suspect that it makes sense to have the number of extinction fraction categories either equal to the number of turnover categories or set to the same category over the tree, but there are actually a lot of possibilities: have turnover=c(1,2,3) and eps=c(1,2,1), for example, or turnover=c(1,1,1) and eps=c(1,2,3). This uses the generateMiSSEGreedyCombinations function to generate a very large set of these possible models, then runs them in increasing complexity. By default, it stops when the models stop getting being reasonable in AICc. This is NOT where the models stop being significant (if you're looking for significance, note you don't get that from AICc), but where they probably will not contribute much to the model averaged parameter estimates and so may not be worth the bother of searching further. However, there's no guarantee that this is a wise decision: you could stop with 10 turnover rates, and 11 and 12 are far worse for AICc, but it could be that 13 turnover rates are much better than anything else (for that matter, the best number of turnover rates could be 42, even though MiSSe's current code can only go up to 26). And of course, in reality, the truth is that there is an infinite set of hidden rate parameters: a passing cloud blocks a tiny bit of energy for photosynthesis, so for that moment the rate of extinction for plants underneath the shadow is a tiny bit higher. You should not be using this to test hypotheses about how many hidden factors there are, but rather as a way to get a good enough model to estimate rates on a tree.</p>
<p>You can change how quickly the function stops trying new models with stop.deltaAICc. Once it runs a chunk of models where the best gets a model that is at least stop.deltaAICc worse than the *current* best model, it stops running new models. Since this is based on current best AICc, and we start with simple models, there's an asymmetry: a terrible model with no rate variation is always included, but a slightly less terrible model with 26 turnover rates might never be run.</p>
<p>This works MUCH faster when run in parallel. To do so, set n.cores to the number of available cores on your machine (for example, for a modern Mac laptop, this would be 4). An easy way to do this automatically is to use n.cores=parallel::detectCores(). The default is one core; if running this function on a cluster, a default of parallel::detectCores() might take over an entire compute node when you're supposed to be using just one core, and get you in trouble. Since we run many models, the most natural approach is to run one model per core, see if at least one of the models are still ok, then send out the next models out to all the cores. Setting n.cores to the number of parallel jobs you want, and setting chunk.size to NULL, will do this. However, this is slightly inefficient -- the odds are that some cores will finish earlier than others, and will be waiting until all finish. So a different approach is to set a chunk.size greater than n.cores -- it will still use no more than n.cores at a time, but once one model in the set finishes it will send off the next until all models in the chunk are run. This keeps the computer even busier, but then it won't stop to check to make sure the models are still feasible as often, and it only saves intermediate results after each chunk of models finishes. Our recommendation is to use n.cores=parallel::detectCores() if you're on a machine where you can use all the cores. By default, we set chunk.size=10 so it looks at ten models before deciding none of them have a good enough AICc to keep looking at all models. If chunk.size is smaller, say, 2, it will look at only two models and if neither is within stop.deltaAICc of the best model, it will stop looking at the next chunk of models.</p>
<p>After every chunk of models are done, this function will display the status: what models have been run, what the likelihoods and AICs are, etc. It will also predict how long future runs will check (based on a linear regression between the number of free parameters and log(minutes to run)). These are just estimates based on the runs so far, but it's a stochastic search and can take more or less time.</p>
<p>Saving output while this goes is highly recommended -- you can see how things are going and salvage something if a run fails (then, start again, deleting the models that worked from possible.combos and USING A DIFFERENT FILE TO SAVE TO SO YOU DON'T OVERWRITE THE OLD ONE. You can so this by giving a file name (including path, if you want) as the save.file argument. This will save the list of finished models (misse.list) and the possible.combos data.frame with additional information.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Beaulieu, J.M, and B.C. O'Meara. 2016. Detecting hidden diversification shifts in models
of trait-dependent speciation and extinction. Syst. Biol. 65:583-601.</p>
<p>FitzJohn R.G., Maddison W.P., and Otto S.P. 2009. Estimating trait-dependent speciation
and extinction rates from incompletely resolved phylogenies. Syst. Biol. 58:595-611.</p>
<p>Herrera-Alsina, L., P. van Els, and R.S. Etienne. 2018. Detecting the dependence of diversification on multiples traits from phylogenetic trees and trait data. Systematic Biology, 68:317-328.</p>
<p>Maddison W.P., Midford P.E., and Otto S.P. 2007. Estimating a binary characters effect on
speciation and extinction. Syst. Biol. 56:701-710.</p>
<p>Nee S., May R.M., and Harvey P.H. 1994. The reconstructed evolutionary process. Philos.
Trans. R. Soc. Lond. B Biol. Sci. 344:305-311.</p>
<p>Vasconcelos, T., B.C. O'Meara, and J.M. Beaulieu. 2022. A flexible method for estimating tip diversification rates across a range of speciation and extinction scenarios. Evolution, 76:1420-1433.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Brian C. O'Meara</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jeremy Beaulieu, Brian O’Meara, Daniel Caetano, James Boyko, Thais Vasconcelos.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

